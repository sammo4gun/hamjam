[gd_scene format=3 uid="uid://dn5ion778qime"]

[ext_resource type="Texture2D" uid="uid://be8dpd8hioe0w" path="res://Sprites/square.png" id="1_7naj2"]
[ext_resource type="Script" uid="uid://cv52yk4doy3dq" path="res://Scripts/square.gd" id="1_mu0s7"]
[ext_resource type="AudioStream" uid="uid://scn805ftnvuo" path="res://SFX/square_attack.mp3" id="5_y5xfp"]
[ext_resource type="Shader" uid="uid://25opi4m6leqw" path="res://Shader/glitch.gdshader" id="6_g0n2n"]
[ext_resource type="Texture2D" uid="uid://blif2c0mtjker" path="res://Sprites/player_indicator.png" id="8_ff18a"]
[ext_resource type="PackedScene" uid="uid://iqr7jqnkcnt2" path="res://Scenes/body.tscn" id="8_y5xfp"]
[ext_resource type="Texture2D" uid="uid://bu4y2766ocx6g" path="res://Sprites/Square/square_main.png" id="9_sudue"]
[ext_resource type="Texture2D" uid="uid://dsdp7pwsxiq1q" path="res://Sprites/Square/square_bl.png" id="10_853fa"]
[ext_resource type="Texture2D" uid="uid://t4u5q6cc4gk5" path="res://Sprites/Square/square_br.png" id="11_2svkt"]
[ext_resource type="Texture2D" uid="uid://dc4xjjal17jhf" path="res://Sprites/shoot.png" id="11_k0cku"]
[ext_resource type="Texture2D" uid="uid://dg6af5axxkge5" path="res://Sprites/Square/square_tl.png" id="12_uu04h"]
[ext_resource type="Texture2D" uid="uid://dnith5ermw40j" path="res://Sprites/SquareAttack/square_attack.png" id="12_y5xfp"]
[ext_resource type="Texture2D" uid="uid://bw73g3buyvjxb" path="res://Sprites/Square/square_tr.png" id="13_bsak4"]

[sub_resource type="CircleShape2D" id="CircleShape2D_mu0s7"]
radius = 20.0

[sub_resource type="Gradient" id="Gradient_4pbwo"]
offsets = PackedFloat32Array(0.0025252525, 0.27525252, 1)
colors = PackedColorArray(1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_2jr70"]
gradient = SubResource("Gradient_4pbwo")
fill = 1
fill_from = Vector2(0.5, 0.5)
fill_to = Vector2(0.8, 0.8)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ff18a"]
resource_local_to_scene = true
shader = ExtResource("6_g0n2n")
shader_parameter/shake_power = 0.1
shader_parameter/shake_rate = 0.0
shader_parameter/shake_speed = 0.1
shader_parameter/shake_block_size = 15.0
shader_parameter/shake_color_rate = 0.01
shader_parameter/u_color = Vector4(1, 1, 1, 1)

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_mu0s7"]
radius = 23.36592
height = 48.0

[sub_resource type="RectangleShape2D" id="RectangleShape2D_2jr70"]
size = Vector2(55.575577, 49.328053)

[sub_resource type="Shader" id="Shader_sudue"]
resource_local_to_scene = true
code = "/*
	Glitch Effect Shader by Yui Kinomoto @arlez80

	MIT License
	Modified to allow flashing colors via u_color
*/

shader_type canvas_item;

// 振動の強さ
uniform float shake_power = 0.03;
// 振動率
uniform float shake_rate : hint_range(0.0, 1.0) = 0.2;
// 振動速度
uniform float shake_speed = 5.0;
// 振動ブロックサイズ
uniform float shake_block_size = 30.5;
// 色の分離率
uniform float shake_color_rate : hint_range(0.0, 1.0) = 0.01;

// Screen texture (keep as in original)
uniform sampler2D SCREEN_TEXTURE : hint_screen_texture, filter_linear_mipmap;

// --- new color uniform for flashing ---
uniform vec4 u_color = vec4(1.0, 1.0, 1.0, 1.0);

float random(float seed)
{
	return fract(543.2543 * sin(dot(vec2(seed, seed), vec2(3525.46, -54.3415))));
}

void fragment()
{
	float enable_shift = float(
		random(trunc(TIME * shake_speed)) < shake_rate
	);

	vec2 fixed_uv = UV;
	fixed_uv.x += (
		random((trunc(UV.y * shake_block_size) / shake_block_size) + TIME) - 0.5
	) * shake_power * enable_shift;

	vec4 pixel_color = textureLod(TEXTURE, fixed_uv, 0.0);
	pixel_color.r = mix(
		pixel_color.r,
		textureLod(TEXTURE, fixed_uv + vec2(shake_color_rate, 0.0), 0.0).r,
		enable_shift
	);
	pixel_color.b = mix(
		pixel_color.b,
		textureLod(TEXTURE, fixed_uv + vec2(-shake_color_rate, 0.0), 0.0).b,
		enable_shift
	);

	// multiply by u_color so script flashes work
	COLOR = pixel_color * u_color;
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_853fa"]
resource_local_to_scene = true
shader = SubResource("Shader_sudue")
shader_parameter/shake_power = 0.03
shader_parameter/shake_rate = 0.2
shader_parameter/shake_speed = 5.0
shader_parameter/shake_block_size = 30.5
shader_parameter/shake_color_rate = 0.01
shader_parameter/u_color = Vector4(1, 1, 1, 1)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_2svkt"]
resource_local_to_scene = true
shader = SubResource("Shader_sudue")
shader_parameter/shake_power = 0.03
shader_parameter/shake_rate = 0.2
shader_parameter/shake_speed = 5.0
shader_parameter/shake_block_size = 30.5
shader_parameter/shake_color_rate = 0.01
shader_parameter/u_color = Vector4(1, 1, 1, 1)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_uu04h"]
resource_local_to_scene = true
shader = SubResource("Shader_sudue")
shader_parameter/shake_power = 0.03
shader_parameter/shake_rate = 0.2
shader_parameter/shake_speed = 5.0
shader_parameter/shake_block_size = 30.5
shader_parameter/shake_color_rate = 0.01
shader_parameter/u_color = Vector4(1, 1, 1, 1)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_bsak4"]
resource_local_to_scene = true
shader = SubResource("Shader_sudue")
shader_parameter/shake_power = 0.03
shader_parameter/shake_rate = 0.2
shader_parameter/shake_speed = 5.0
shader_parameter/shake_block_size = 30.5
shader_parameter/shake_color_rate = 0.01
shader_parameter/u_color = Vector4(1, 1, 1, 1)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_e7u4j"]
resource_local_to_scene = true
shader = SubResource("Shader_sudue")
shader_parameter/shake_power = 0.03
shader_parameter/shake_rate = 0.2
shader_parameter/shake_speed = 5.0
shader_parameter/shake_block_size = 30.5
shader_parameter/shake_color_rate = 0.01
shader_parameter/u_color = Vector4(1, 1, 1, 1)

[sub_resource type="AtlasTexture" id="AtlasTexture_ou3cv"]
atlas = ExtResource("11_k0cku")
region = Rect2(0, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_q2pd1"]
atlas = ExtResource("11_k0cku")
region = Rect2(128, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_8wq5q"]
atlas = ExtResource("11_k0cku")
region = Rect2(256, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_lwtj6"]
atlas = ExtResource("11_k0cku")
region = Rect2(384, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_80q7h"]
atlas = ExtResource("11_k0cku")
region = Rect2(512, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_w6uka"]
atlas = ExtResource("11_k0cku")
region = Rect2(640, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_whkl4"]
atlas = ExtResource("11_k0cku")
region = Rect2(768, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_hg21s"]
atlas = ExtResource("11_k0cku")
region = Rect2(896, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_d1fh7"]
atlas = ExtResource("11_k0cku")
region = Rect2(1024, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_uwu1r"]
atlas = ExtResource("11_k0cku")
region = Rect2(1152, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_yxsct"]
atlas = ExtResource("12_y5xfp")
region = Rect2(0, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_b5fcs"]
atlas = ExtResource("12_y5xfp")
region = Rect2(128, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_pilda"]
atlas = ExtResource("12_y5xfp")
region = Rect2(256, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_r3cyl"]
atlas = ExtResource("12_y5xfp")
region = Rect2(384, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_wf36i"]
atlas = ExtResource("12_y5xfp")
region = Rect2(512, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_47rig"]
atlas = ExtResource("12_y5xfp")
region = Rect2(640, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_yj7if"]
atlas = ExtResource("12_y5xfp")
region = Rect2(768, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_vwk4u"]
atlas = ExtResource("12_y5xfp")
region = Rect2(896, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_ebkxf"]
atlas = ExtResource("12_y5xfp")
region = Rect2(1024, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_f0ejv"]
atlas = ExtResource("12_y5xfp")
region = Rect2(1152, 0, 128, 128)

[sub_resource type="AtlasTexture" id="AtlasTexture_acthd"]
atlas = ExtResource("12_y5xfp")
region = Rect2(1280, 0, 128, 128)

[sub_resource type="SpriteFrames" id="SpriteFrames_6ucqr"]
resource_local_to_scene = true
animations = [{
"frames": [{
"duration": 1.0,
"texture": null
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ou3cv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_q2pd1")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_8wq5q")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_lwtj6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_80q7h")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_w6uka")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_whkl4")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_hg21s")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_d1fh7")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_uwu1r")
}, {
"duration": 1.0,
"texture": null
}],
"loop": false,
"name": &"default",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": null
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_yxsct")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_b5fcs")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_pilda")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_r3cyl")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_wf36i")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_47rig")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_yj7if")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_vwk4u")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ebkxf")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_f0ejv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_acthd")
}, {
"duration": 1.0,
"texture": null
}],
"loop": false,
"name": &"square_attack",
"speed": 5.0
}]

[sub_resource type="CircleShape2D" id="CircleShape2D_2jr70"]
radius = 300.0

[node name="Square" type="CharacterBody2D" unique_id=1548567980]
scale = Vector2(1.5407054, 1.5407054)
motion_mode = 1
script = ExtResource("1_mu0s7")

[node name="CollisionShape2D" type="CollisionShape2D" parent="." unique_id=1915569533]
shape = SubResource("CircleShape2D_mu0s7")

[node name="Light" type="PointLight2D" parent="." unique_id=1491677763]
energy = 0.5
shadow_enabled = true
texture = SubResource("GradientTexture2D_2jr70")
texture_scale = 2.3

[node name="Sprite2D" type="Sprite2D" parent="." unique_id=738823433]
visible = false
material = SubResource("ShaderMaterial_ff18a")
position = Vector2(0, 1)
rotation = -1.5642526
scale = Vector2(0.40451542, 0.40451542)
texture = ExtResource("1_7naj2")

[node name="PlayerIndicator" type="Sprite2D" parent="Sprite2D" unique_id=608273771]
position = Vector2(-11, -1)
scale = Vector2(0.3128148, 0.3128148)
texture = ExtResource("8_ff18a")

[node name="NavigationAgent2D" type="NavigationAgent2D" parent="." unique_id=995240591]
avoidance_enabled = true
radius = 30.0
neighbor_distance = 100.0

[node name="AttackDetectorArea" type="Area2D" parent="." unique_id=539582286]
position = Vector2(23.365921, 0)
rotation = 1.5707964

[node name="CollisionShape2D" type="CollisionShape2D" parent="AttackDetectorArea" unique_id=158937419]
position = Vector2(1.8167654e-07, -1.2981066)
shape = SubResource("CapsuleShape2D_mu0s7")

[node name="AttackArea" type="Area2D" parent="." unique_id=1370061280]
position = Vector2(20.5, -2.5)

[node name="CollisionShape2D" type="CollisionShape2D" parent="AttackArea" unique_id=1744985900]
position = Vector2(16.617546, 2.4999993)
shape = SubResource("RectangleShape2D_2jr70")

[node name="AttackSound" type="AudioStreamPlayer2D" parent="." unique_id=557452543]
scale = Vector2(0.64905334, 0.64905334)
stream = ExtResource("5_y5xfp")
volume_db = -12.688
pitch_scale = 1.02

[node name="SwitchFinder" type="RayCast2D" parent="." unique_id=1087052971]
target_position = Vector2(500, 0)

[node name="Body" parent="." unique_id=1351006833 instance=ExtResource("8_y5xfp")]
rotation = 1.5707964
scale = Vector2(0.4, 0.4)
i_am_a_square = true

[node name="Main" parent="Body" index="0" unique_id=1935420016]
material = SubResource("ShaderMaterial_853fa")
texture = ExtResource("9_sudue")

[node name="Q1" parent="Body" index="1" unique_id=712174551]
material = SubResource("ShaderMaterial_2svkt")
position = Vector2(-43.8111, 40.565826)
texture = ExtResource("10_853fa")
offset = Vector2(43.8111, -40.565826)

[node name="Q2" parent="Body" index="2" unique_id=498922028]
material = SubResource("ShaderMaterial_uu04h")
position = Vector2(43.8111, 43.811096)
texture = ExtResource("11_2svkt")
offset = Vector2(-43.8111, -43.811096)

[node name="Q3" parent="Body" index="3" unique_id=1851037625]
material = SubResource("ShaderMaterial_bsak4")
position = Vector2(-43.811096, -43.811096)
texture = ExtResource("12_uu04h")
offset = Vector2(43.811096, 43.811096)

[node name="Q4" parent="Body" index="4" unique_id=234754461]
material = SubResource("ShaderMaterial_e7u4j")
position = Vector2(42.18847, -45.43373)
texture = ExtResource("13_bsak4")
offset = Vector2(-42.18847, 45.43373)

[node name="AttackAnim" parent="Body" index="5" unique_id=1281946594]
position = Vector2(1.1266216e-06, -102.22591)
sprite_frames = SubResource("SpriteFrames_6ucqr")

[node name="EntityView" type="Area2D" parent="." unique_id=39565044]

[node name="CollisionShape2D" type="CollisionShape2D" parent="EntityView" unique_id=850463964]
shape = SubResource("CircleShape2D_2jr70")

[node name="PlayerIndicator" type="Sprite2D" parent="." unique_id=555485528]
visible = false
position = Vector2(-9.086747, 0)
scale = Vector2(0.3128148, 0.3128148)
texture = ExtResource("8_ff18a")

[connection signal="velocity_computed" from="NavigationAgent2D" to="." method="_on_navigation_agent_2d_velocity_computed"]

[editable path="Body"]
